<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SGIP Eligibility & Incentive Calculator</title>
  <style>
    /* SGIP Branding Colors */
    :root {
      --sgip-blue: #003C71;
      --sgip-gold: #F2C94C;
      --bg-light: #F9F9F9;
      --text-dark: #2A2A2A;
      --text-light: #555555;
      --radius: 8px;
      --shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-light);
      color: var(--text-dark);
      line-height: 1.6;
    }
    header {
      background: var(--sgip-blue);
      color: white;
      padding: 1rem;
      text-align: center;
      box-shadow: var(--shadow);
    }
    header h1 { margin: 0; font-size: 1.6rem; }
    header nav a {
      color: var(--sgip-gold);
      margin-left: 1rem;
      text-decoration: none;
      font-weight: bold;
    }
    .main {
      display: flex;
      flex-wrap: wrap;
      padding: 2rem;
      gap: 1rem;
    }
    .form-panel, .map-panel {
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.5rem;
    }
    .form-panel { flex: 1 1 300px; max-width: 350px; }
    .map-panel { flex: 2 1 600px; }
    form .field { margin-bottom: 1rem; }
    form label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
    }
    form select, form input {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ccc;
      border-radius: var(--radius);
      font-size: 1rem;
      background: var(--bg-light);
    }
    form button {
      width: 100%;
      padding: 0.75rem;
      background: var(--sgip-gold);
      color: var(--sgip-blue);
      border: none;
      border-radius: var(--radius);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: background 0.3s;
    }
    form button:hover { background: #e0b43a; }
    .arcgis-maps {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .arcgis {
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
    }
    .arcgis h2 {
      margin: 0;
      padding: 0.75rem;
      background: var(--sgip-blue);
      color: white;
      font-size: 1rem;
      font-weight: 600;
    }
    .arcgis iframe {
      width: 100%;
      height: 300px;
      border: none;
    }
    .guide {
      margin-top: 2rem;
      background: var(--bg-light);
      padding: 1rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .guide h2 {
      margin-top: 0;
      color: var(--sgip-blue);
      font-size: 1.25rem;
    }
    .guide ul {
      padding-left: 1.25rem;
    }
    @media (max-width: 768px) {
      .main { flex-direction: column; }
      .map-panel { order: -1; }
    }
  </style>
</head>
<body>
  <header>
    <h1>SGIP Eligibility & Incentive Calculator</h1>
    <nav><a href="sgip-guides.html">SGIP Guides</a></nav>
  </header>
  <div class="main">
    <section class="map-panel">
      <div class="arcgis-maps">
        <div class="arcgis">
          <h2>SB 535 Disadvantaged Communities</h2>
          <iframe src="https://experience.arcgis.com/experience/1c21c53da8de48f1b946f3402fbae55c/page/SB-535-Disadvantaged-Communities/" title="DAC Map"></iframe>
        </div>
        <div class="arcgis">
          <h2>Tier 2/3 Wildfire Threat Zone</h2>
          <iframe src="https://capuc.maps.arcgis.com/apps/webappviewer/index.html?id=5bdb921d747a46929d9f00dbdb6d0fa2" title="Wildfire Threat Map"></iframe>
        </div>
      </div>
    </section>
    <aside class="form-panel">
      <form id="calcForm">
        <div class="field">
          <label for="customerType">Host Customer Class</label>
          <select id="customerType">
            <option value="">Select...</option>
            <option value="residential-single">Residential Single-Family</option>
            <option value="residential-multi">Residential Multifamily</option>
            <option value="commercial">Commercial/Business</option>
            <option value="industrial">Industrial/Agricultural</option>
          </select>
        </div>
        <div class="field">
          <label for="inDAC">Disadvantaged Community?</label>
          <select id="inDAC"><option value="yes">Yes</option><option value="no">No</option></select>
        </div>
        <div class="field">
          <label for="inFire">Tier 2/3 Wildfire Threat Zone?</label>
          <select id="inFire"><option value="yes">Yes</option><option value="no">No</option></select>
        </div>
        <div class="field">
          <label for="capacity">Storage Capacity (kWh)</label>
          <input type="number" id="capacity" min="0" placeholder="e.g., 30" />
        </div>
        <div class="field">
          <label for="solarCapacity">Solar PV Capacity (kW)</label>
          <input type="number" id="solarCapacity" min="0" step="0.1" placeholder="e.g., 5" />
        </div>
        <div class="field">
          <button type="button" id="btnCheck">Calculate Incentive</button>
        </div>
      </form>
      <div class="guide">
        <h2>SGIP Program Guide</h2>
        <ul>
          <li><strong>General Market Storage:</strong> Base incentives for storage; for customers not in equity budgets.</li>
          <li><strong>Small Residential Storage:</strong> Capped at 30 kWh, same step rates as general market.</li>
          <li><strong>Residential Solar & Storage Equity:</strong> Enhanced rates for low-income DAC customers and equity participants.</li>
          <li><strong>Equity Resiliency:</strong> Added incentives for systems in wildfire threat zones or PSPS-impacted areas.</li>
          <li><strong>San Joaquin Valley:</strong> Pilot incentives for eligible SJV communities.</li>
          <li><strong>Generation (AB 209 Solar):</strong> Incentives per kW for solar PV installations.</li>
        </ul>
      </div>
      <div id="result" class="result" style="display:none;"></div>
    </aside>
  </div>
  <script>
    const rates={general:0.25,smallRes:0.15,equity:1.10,resiliency:1.00,sjv:1.10,solar:3.10,generation:2.00};
    document.getElementById('btnCheck').addEventListener('click',()=>{
      const cap=parseFloat(document.getElementById('capacity').value)||0;
      const sol=parseFloat(document.getElementById('solarCapacity').value)||0;
      const inDAC=document.getElementById('inDAC').value==='yes';
      const inFire=document.getElementById('inFire').value==='yes';
      const breakdown=[];
      breakdown.push(`General Market: $${(cap*1000*rates.general).toLocaleString()}`);
      breakdown.push(`Small Residential: $${(cap*1000*rates.smallRes).toLocaleString()}`);
      if(inDAC) breakdown.push(`Equity Storage: $${(cap*1000*rates.equity).toLocaleString()}`);
      if(inFire) breakdown.push(`Equity Resiliency: $${(cap*1000*rates.resiliency).toLocaleString()}`);
      breakdown.push(`San Joaquin Valley: $${(cap*1000*rates.sjv).toLocaleString()}`);
      breakdown.push(`AB209 Solar: $${(sol*1000*rates.solar).toLocaleString()}`);
      breakdown.push(`Generation: $${(sol*1000*rates.generation).toLocaleString()}`);
      const res=document.getElementById('result');
      res.innerHTML=`<h2>Incentive Breakdown</h2><ul>${breakdown.map(i=>`<li>${i}</li>`).join('')}</ul>`;
      res.style.display='block';
    });
  </script>
</body>
</html>
